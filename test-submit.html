<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Team Submission</title>
</head>
<body>
  <h1>Test Team Submission</h1>
  <div id="output">Testing...</div>
  <button id="testBtn">Run Test</button>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const supabaseUrl = 'YOUR_SUPABASE_URL';
      const supabaseKey = 'YOUR_SUPABASE_KEY';
      const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
      const output = document.getElementById('output');
      
      document.getElementById('testBtn').addEventListener('click', async function() {
        try {
          output.textContent = 'Testing team submission...';
          
          // First, try to get the user
          const { data: { user }, error: userError } = await supabase.auth.getUser();
          
          if (userError) {
            output.textContent = 'User error: ' + userError.message;
            return;
          }
          
          if (!user) {
            output.textContent = 'No authenticated user found';
            return;
          }
          
          // Hard-code a test submission
          const testData = {
            userId: user.id,
            tournamentId: '1', // Use a valid tournament ID from your database
            players: [
              { id: '1', price: 3200 },
              { id: '2', price: 2800 },
              { id: '3', price: 2500 },
              { id: '4', price: 2200 }
            ]
          };
          
          output.textContent = 'Creating team...';
          
          // Create team
          const { data: team, error: teamError } = await supabase
            .from('teams')
            .insert([
              { 
                user_id: testData.userId,
                tournament_id: testData.tournamentId,
                total_spent: testData.players.reduce((sum, p) => sum + p.price, 0),
                created_at: new Date().toISOString()
              }
            ])
            .select();
            
          if (teamError) {
            output.textContent = 'Team creation error: ' + teamError.message;
            console.error(teamError);
            return;
          }
          
          output.textContent = 'Team created. Adding players...';
          console.log('Team:', team);
          
          // Add team players
          const teamId = team[0].id;
          const teamPlayers = testData.players.map(player => ({
            team_id: teamId,
            player_id: player.id,
            price: player.price
          }));
          
          const { error: playersError } = await supabase
            .from('team_players')
            .insert(teamPlayers);
            
          if (playersError) {
            output.textContent = 'Team players error: ' + playersError.message;
            console.error(playersError);
            return;
          }
          
          output.textContent = 'Success! Team and players added.';
        } catch (err) {
          output.textContent = 'Exception: ' + err.message;
          console.error(err);
        }
      });
    });
  </script>
</body>
</html>
